<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit</title>
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"> -->
  <link rel="stylesheet" href="/css/getMoreAddContent.css">
  <link rel="stylesheet" href="/css/animation.css">
  <link rel="stylesheet" href="/css/sweet.css">
  <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.1/css/boxicons.min.css">
  <%- include("./partials/header.ejs")%>
  <style>
     .toolbar {
      padding: 16px;
      background: #eee;
    }

    .toolbar .head {
      display: flex;
      grid-gap: 10px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .toolbar .head>input {
      max-width: 100px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 2px solid #ddd;
      outline: none;
    }

    .toolbar .head select {
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 6px;
      outline: none;
      cursor: pointer;
    }

    .toolbar .head .color {
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 6px;
      outline: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      grid-gap: 6px;
      padding: 0 10px;
    }

    .toolbar .head .color span {
      font-size: 14px;
    }

    .toolbar .head .color input {
      border: none;
      padding: 0;
      width: 26px;
      height: 26px;
      background: #fff;
      cursor: pointer;
    }

    .toolbar .head .color input::-moz-color-swatch {
      width: 20px;
      height: 20px;
      border: none;
      border-radius: 50%;
    }

    .toolbar .btn-toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      grid-gap: 10px;
    }

    .toolbar .btn-toolbar button {
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .toolbar .btn-toolbar button:hover {
      background: #f3f3f3;
    }

    #content {
      padding: 16px;
      outline: none;
      max-height: 50vh;
      overflow: auto;
    }

    #show-code[data-active="true"] {
      background: #eee;
    }

    .choose-layout {
      border: 3px solid #0062cb;
      height: 250px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 0.5em;
    }

    .choose-layout:hover>p {
      font-size: xx-large !important;
      transition: 0.3s;
    }

    .choose-layout>p {
      transition-duration: 0.3s !important;
    }

    .drop-zone {
      background-color: #F0F0F0;
      border: 1px dashed #CCC;
      padding: 10px;
      text-align: center;
      vertical-align: middle;
    }
    .pdf-iframe {
      width: 100%;
      height: calc(100vh - 50px);
      /* Adjust height based on toolbar */
      border: none;
    }

    .disbled-a {
      background-color: #999999 !important;
      border: 1px solid #999999 !important;
      pointer-events: none !important;
      /* ป้องกันการคลิก */
    }

    .allContent {
      height: fit-content !important;
    }

    .oldContent {
      height: fit-content !important;
    }

    .hide-layout-2 {
      display: none;
      opacity: 0;
      transition: opacity 0.5s ease;
      height: fit-content !important;

    }


    .addLayout01Form {
      padding-bottom: 1em !important;
    }

    .show-layout-2 {
      display: block;
      opacity: 1;
      /* สิ้นสุดที่ความทึบ 1 */
      transition: opacity 0.5s ease;
      /* กำหนดการเปลี่ยนแปลงที่ต้องการ */
      height: fit-content !important;

    }

    .showoldlayoutSpan,
    .hidoldlayoutSpan {
      font-size: smaller !important;
    }

    .showAndHideBtn {
      height: fit-content !important;
    }


    .hideOldContentDiv,
    .showOldContentDiv {
      display: flex;
      justify-content: start;
    }

    .hideOldContentDiv,
    .hidedContent {
      display: none;
    }

    .showOldContent {
      display: block;
      opacity: 1;
      /* สิ้นสุดที่ความทึบ 1 */
      transition: opacity 0.5s ease;
      /* กำหนดการเปลี่ยนแปลงที่ต้องการ */
      height: fit-content !important;

    }

    .hide-layout-2 {
      height: fit-content !important;
    }

    .teaxtAreaLayout4_1 {
      text-indent: 1em !important;
      padding-top: 1em !important;
      width: 100% !important;
      border: none !important;

    }

    .addAndMinus {
      border: none !important;
      margin-left: 0.5em !important;
      background-color: #DDE6ED1A !important;
    }

    .addAnd:hover .bi-plus-square {
      display: none !important;
    }

    .addAnd:hover .bi-plus-square-fill {
      display: inline !important;
    }

    .minusAnd:hover .bi-dash-square {
      display: none !important;
    }

    .minusAnd:hover .bi-dash-square-fill {
      display: inline !important;
    }


    .setBorder {
      border: 0.125px solid black;
      border-radius: 0.5em !important;
      box-shadow: rgba(50, 50, 93, 0.25) 0px 50px 100px -20px, rgba(0, 0, 0, 0.3) 0px 30px 60px -30px !important;
      padding: 0.10em !important;
      text-indent: 0.25em !important;
      font-size: medium !important;
      margin-bottom: 0.5em !important;
    }

    .cancelIcon,
    .cancelIcon2,
    .cancelIcon3,
    .cancelIcon4 {
      font-size: 2em !important;
      border: none !important;
      background-color: white !important;
      margin-bottom: 0em !important;
    }

    .lesson-bar {
      border-left: 0.25em solid #ffc107 !important;
      padding-left: 0.5em !important;
      margin-right: 0.5em !important;

    }

    .set-border-title {
      border: 0.125em solid #007bff;
      border-radius: 0.5em;
    }

    .set-border-title-2 {
      border: 0.125em solid #007bff;
      border-radius: 0.5em;


    }

    .ImageScript {
      border-top: 0.125em solid #007bff;
      border-radius: 0.5em;
      box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px !important;
      height: max-content;

    }

    .layout-1-typing {
      /* box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px !important; */
      box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
      border-radius: 0.25em;
      border-top: 0.125em solid #007bff;
      border-bottom-left-radius: 0.5em;
      border-bottom-right-radius: 0.5em;
      max-width: 28em !important;
      /* width: auto; */
      padding-top: 0.5em !important;
      height: 18.75em;
      /* หรือค่าสูงสุดที่คุณต้องการ */
      /* เพื่อให้มีการเลื่อนเนื้อหาเมื่อเกินขนาดที่กำหนด */
      background-color: white;
      margin-bottom: 1em !important;
      overflow-y: auto !important;

    }

    .layout-1-topic-p,
    .layout-1-MainDescription-p {
      border-bottom: 0.5px solid #ced4daac;
      padding-top: 0.5em !important;
    }

    .layout-1-MainDescription-p2 {
      border-bottom: 0.5px solid #ced4daac;
      /* padding-top: 0.5em !important; */
      margin: 0.5em 0.5em !important;
      font-size: small !important;
    }

    .layout-1-MainDescription-p3 {

      border-bottom: 0.5px solid #ced4daac;
      /* padding-top: 0.5em !important; */
      margin: 1em 1.5em !important;
      font-size: small !important;

    }

    .layout-1-MainDescription-p {
      margin-left: 2em !important;
      margin-right: 1em !important;
    }

    .content-1 {
      border-top: 0.125em solid #007bff;
      border-radius: 0.5em;
      margin-top: 1em !important;
    }

    .set-grid {
      display: grid;
      grid-template-columns: 0.5fr 1fr;

    }

    #outputParagraph2,
    #outputParagraph3,
    #outputParagraph6 {
      font-size: smaller !important;
    }

    #outputParagraph4 {
      font-size: x-small;
    }

    video {
      border-radius: 0.5em;
      box-shadow: rgba(67, 71, 85, 0.27) 0px 0px 0.25em, rgba(90, 125, 188, 0.05) 0px 0.25em 1em;

    }

    #outputParagraph3 {
      max-width: 28em;

    }

    .img222 {
      border-radius: 0.5em;
      width: 80%;
      /* justify-content: center; */
    }

    .img223 {
      border-radius: 0.25em;
      width: 100%;
      /* justify-content: center; */
    }

    .border-div {
      border: 1px solid #ced4da;
      width: 80%;
    }

    .exampleLayout-2 {
      box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px !important;
      border-radius: 0.25em !important;
      height: max-content;
      margin-top: 1em !important;
      padding-bottom: 1em !important;


    }

    .exampleLayout {
      border-bottom: 0.125em solid #007bff !important;
      box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px !important;
      border-radius: 0.25em !important;
      padding-bottom: 1em !important;

    }


    /* .exampleLayout2-2 {

    } */

    .layout-2-typing {
      /* box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px !important; */
      box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
      border-radius: 0.25em;
      border-top: 0.125em solid #007bff;


      border-bottom-left-radius: 0.5em;
      border-bottom-right-radius: 0.5em;
      max-width: 28em !important;
      /* width: auto; */
      padding-top: 0.5em !important;
      padding-bottom: 1em !important;

      height: 14em;
      /* หรือค่าสูงสุดที่คุณต้องการ */
      /* เพื่อให้มีการเลื่อนเนื้อหาเมื่อเกินขนาดที่กำหนด */
      background-color: white;
      overflow-y: auto !important;

    }

    .layout-3-typing {
      /* box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px !important; */
      box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
      border-radius: 0.25em;
      border-top: 0.125em solid #007bff;


      border-bottom-left-radius: 0.5em;
      border-bottom-right-radius: 0.5em;
      max-width: 28em !important;
      /* width: auto; */
      padding-top: 0.5em !important;
      padding-bottom: 1em !important;
      height: fit-content;
      /* หรือค่าสูงสุดที่คุณต้องการ */
      /* เพื่อให้มีการเลื่อนเนื้อหาเมื่อเกินขนาดที่กำหนด */
      background-color: white;

    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    input[type=file] {
      border: 1px solid #ced4da;
      border-radius: 0.5em;

    }

    input[type=file]::file-selector-button {
      margin-right: 1em;
      border-top: none;
      border-left: none;
      border-bottom: none;
      border-right: 1px solid #ced4da;
      ;
      background: white;
      padding: 0.5em 1em;
      border-radius: 0.5em;
      color: #084cdf;
      cursor: pointer;
      transition: background .2s ease-in-out;

    }

    input[type=file]::file-selector-button:hover {
      background: #0d45a5;
      color: white;
    }

    .img-input::placeholder {
      color: #ced4da !important;
    }
  </style>

</head>

<body>
  <div id="blur-container">
    <%- include("./partials/nav.ejs")%>
    <!-- <div class="above-nav d-flex px-4 py-3">
      <div class="home-div above-nav-home d-flex mx-2 my-0 align-middle">
        <i class="bi bi-house mx-2"></i>
        <a href="/adminIndex" class="a-home">
          <p class="m-0">หน้าหลัก &nbsp;&nbsp;></p>
        </a>
      </div>
      <a href="#" class="status-a mx-2 my-0 align-middle">
        <p class="m-0">บทเรียน</p>
      </a>
    </div> -->
    <div class="main-content d-flex w-100 h-auto bg-white">
      <% const pageName = "adminEdit" %>
      <%- include("./partials/lessonsList.ejs", { pageName: pageName })%>
      <div class="row allContent bg-white" style="width: 80%;">
        <div class="col-12 oldContent bg-white aside-right px-4 py-4" style="width: 100% !important;">
          <div class="manange-bar px-4 py-3 bg-white w-100" style="margin-bottom: 1.5em !important;">
            <div class="d-flex" style="border-bottom: 1px solid #ced4daa0; padding-bottom: 0.5em !important;">
              <div class="d-flex w-75" style="align-items: center; grid-template-columns: 0.5fr 1.5fr;">
                <p class="fw-bold w-auto fs-6 lesson-bar">แก้ไขเนื้อหา</p>
                <p class="fw-normal w-auto fs-6" style="margin-left: 0.5em !important;">บทเรียน:
                  <span class="fw-normal fs-6 text-primary" style="margin-right: 1em !important;"><%=lesson.LessonName%></span>

                </p>
                <a href="/adminIndex/editLesson?lessonId=<%=lesson._id%>&subjectId=<%=subject._id%>" class="edit-a text-dark px-2" style="border-left: 1px solid #ced4daa0 ;margin:0em 1em !important; font-size: small;">แก้ไขชื่อและรูปปก<i class="bi bi-pencil mx-2"></i>
                </a>
              </div>
              <div class="d-flex w-25 justify-content-end" style="align-items: center; margin-top: 0.5 !important;">
                <a href="/adminIndex/eachLessons?lessonId=<%=lesson._id%>" class="return-a text-primary">กลับสู่เนื้อหา<i class="bi bi-arrow-return-left mx-2"></i>
                </a>
              </div>
            </div>
            <% const questions = lesson.lessonQuestion %>
            <div class="d-flex">
              <div class="d-flex w-50">
                <a href="/adminIndex/getMoreAddContent?lesson=<%=lesson._id%>" class="add-button btn btn-primary my-2 p-2" style="height: fit-content !important;">
                  เพิ่มเนื้อหา<i class="bi bi-plus-circle-fill mx-2"></i>
                </a>
                <button href="/adminIndex/editLesson?lesson=<%=lesson._id%>" disabled class="btn add-button btn-warning my-2 p-2 mx-2" style="height: fit-content !important;">
                  แก้ไขเนื้อหาภายในบทเรียน<i class="bi bi-pencil-square mx-2"></i>
                </button>
                <% if (questions) {%>
                <button class="btn add-button btn-info my-2 p-2" style="height: fit-content !important;" disabled>
                  เพิ่มคำถามท้ายบท<i class="bi bi-question-circle mx-2"></i>
                </button>
                <% } else { %>
                <a href="/adminIndex/addEndChapterQuestion?lesson=<%=lesson._id%>" class="btn add-button btn-info my-2 p-2" style="height: fit-content !important;">
                  เพิ่มคำถามท้ายบท<i class="bi bi-question-circle mx-2"></i>
                </a>
                <% } %>
              </div>
              <div class="d-flex w-50 justify-content-end">
                <a href="/adminIndex/deleteLesson?lessonId=<%=lesson._id%>" class="btn add-button btn-danger my-2 p-2 mx-2" style="height: fit-content !important;">
                  ลบบทเรียน: <span class="text-light"><%=lesson.LessonName%></span><i class="bi bi-eraser-fill mx-2"></i>
                </a>
              </div>
            </div>
            <!-- <div class="d-flex">
              <div class="d-flex w-50">
                <a href="/adminIndex/getMoreAddContent?lesson=<%=lesson._id%>" class="add-button btn btn-primary my-2 p-2">
                  เพิ่มเนื้อหา<i class="bi bi-plus-circle-fill mx-2"></i>
                </a>
                <a href="/adminIndex/editLesson?lesson=<%=lesson._id%>" class="btn add-button btn-warning my-2 p-2 mx-2" style="height: fit-content !important;">
                  แก้ไขเนื้อหาภายในบทเรียน<i class="bi bi-pencil-square mx-2"></i>
                </a>
              </div>
              <div class="d-flex w-50 justify-content-end">
                <a href="/adminIndex/deleteLesson?lessonId<%=lesson._id%>" class="btn add-button btn-danger my-2 p-2 mx-2" style="height: fit-content !important;">
                  ลบบทเรียน: <span class="text-light"><%=lesson.LessonName%></span><i class="bi bi-eraser-fill mx-2"></i>
                </a>
              </div>
            </div> -->
          </div>
          <!-- <div class="manange-bar p-4 bg-white w-100">
            <div class="d-flex" style="align-items: center;">
              <div class="d-flex w-50" style="align-items: center;">
                <p class="fw-bold w-auto fs-5 lesson-bar">แก้ไขเนื้อหา</p>
                <p class="fw-normal w-auto fs-6" style="margin-left: 0.5em !important;">บทเรียน:
                  <span class="fw-normal fs-6 text-primary" style="margin-right: 1em !important;"><%=lesson.LessonName%></span>
                  ปีการศึกษา:
                  <span class="fw-normal fs-6 text-primary">2566</span>
                </p>
              </div>
              <div class="d-flex w-50 justify-content-end" style="align-items: center;">
                <a href="/adminIndex/eachLessons?lessonId=<%=lesson._id%>" class="return-a text-primary">กลับสู่เนื้อหา<i class="bi bi-arrow-return-left mx-2"></i>
                </a>
              </div>
            </div>
            <a href="/adminIndex/getMoreAddContent?lesson=<%=lesson._id%>" class="add-button btn btn-primary my-2 p-2">
              เพิ่มเนื้อหา<i class="bi bi-plus-circle-fill mx-2"></i>
            </a>
            <a href="/adminIndex/adminLessonIndex" class="disbled-a add-button btn btn-warning text-white my-2 p-2">
              แก้ไขเนื้อหา<i class="bi bi-pencil-square mx-2"></i>
            </a>
            <a href="/adminIndex/adminLessonIndex" class="add-button btn btn-danger my-2 p-2">
              ลบบทเรียน<i class="bi bi-eraser-fill mx-2"></i>
            </a>
          </div> -->
          <% if (paginatedLayouts.length > 0) { %>
          <% paginatedLayouts.forEach(Layout => {%>
          <% if (Layout.name == "Layout01") {%>
          <div class="hide-layout-11 lesson-content py-2 bg-white my-1">
            <div class="d-flex mx-4">
              <p class="fw-bold fs-4 my-3 setpBorder">แก้ไขเนื้อหา รูปแบบที่ 1</p>
            </div>
            <!-- <div class="d-flex mx-4">
                <p class="fw-bold fs-4 my-3">ส่วนของการเพิ่มเนื้อหาของบทเรียน</p>
              </div> -->
            <form class="addLayout01Form" action="/adminIndex/makeEdit" method="post" enctype="multipart/form-data">
              <input class="d-none" type="text" name="_id" value="<%= lesson._id %>">
              <input class="d-none" type="text" name="layoutId" value="<%= Layout._id %>">
              <div class="row px-4 py-1">
                <div class="underForm-1 col-6">
                  <div class="my-1 mb-3">
                    <label for="Topic" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 1 >> </span>หัวข้อ: </label>
                    <input type="text" class="form-control p-3 w-75 layout-1-topic" name="Topic" id="topicInput" value="<%=Layout.Topic%>" required>
                  </div>
                  <div class="form my-1 mb-3">
                    <label for="MainDescription" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 2 >> </span>คำอธิบายเพิ่มเติม: </label>
                    <textarea class="form-control w-75 p-3" name="MainDescription" id="topicInput2" style="height: 100px;"><%=Layout.MainDescription%></textarea>
                  </div>
                  <div class="form my-1 mb-3">
                    <label for="subDescription" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 3 >> </span>คำอธิบายเนื้อหาหลัก: </label>
                    <textarea class="form-control w-75 p-3" name="SubDescription" id="topicInput3" style="height: 100px;"><%=Layout.SubDescription%></textarea>
                  </div>
                  
                  <div class="form my-1 mb-3">
                    <label for="ImageDescription" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 6 >> </span>คำอธิบายเกี่ยวกับรูปภาพ: </label>
                    <textarea class="form-control w-75 p-3" name="ImageDescription" id="topicInput6" style="height: 100px;"><%=Layout.AboutImage[0].ImageDescription%></textarea>
                  </div>
                </div>
                <div class="underForm-1 col-6">
                  <div class="form my-1 mb-3">
                    <label for="title" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 4 >> </span>ชื่อรูปภาพ: </label>
                    <input type="text" class="form-control p-3 w-75" name="title" id="topicInput4" value="<%=Layout.AboutImage[0].title %>" required>
                  </div>
                  <div class="my-1 mb-3">
                    <label for="Url" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 5 >> </span>รูปภาพ: </label><br>
                    <input type="file" class="w-75 img-input" id="topicInput5" style="background-color: white !important;" name="Url" accept="image/*,video/*">
                    <p class="fw-bold fs-6" style="margin-top: 1em !important;">รูปภาพหรือวิดีโอ เดิมที่ใช้: </p>
                    <div class="w-100">
                      <% const file = Layout.AboutImage[0].file %>
                      <% if (Layout.AboutImage[0].contentType.startsWith("image/")) { %>
                      <img class="ImageFile w-75 h-75 my-4 shadow rounded" src="<%=file%>" alt="รูปภาพประกอบการเรียน">
                      <%} else if (Layout.AboutImage[0].contentType.startsWith("video/")) {%>
                      <video class="w-75 h-75 my-4" controls autoplay>
                        <source src="<%=file%>" type="<%=Layout.AboutImage[0].contentType%>">
                        Your browser does not support the video tag.
                      </video>
                      <% } %>
                    </div>
                  </div>
                </div>

                <div class="d-flex col-12 row">
                  <div class="col-6">
                    <button type="submit" class="setRadius submitBtn btn btn-success my-3 p-2 shadow-sm w-25">บันทึก
                      <i class="bi bi-save-fill mx-2"></i>
                    </button>
                    <a href="/adminIndex/deleteLayout?layoutId=<%=Layout._id%>&whatLayout=1&lessonId=<%=lesson._id%>" type="button" class="cancelBtn1 setRadius submitBtn btn btn-danger my-3 p-2 shadow-sm w-25 mx-3">ลบ
                      <!-- <i class="bi bi-save-fill mx-2"></i> -->
                      <i class="bi bi-eraser-fill mx-2"></i>
                    </a>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <% } else if (Layout.name == "Layout02") {%>
          <div class="lesson-content py-2 bg-white my-4">
            <div class="d-flex mx-4">
              <p class="fw-bold fs-4 my-3 setpBorder">แก้ไขเนื้อหา รูปแบบที่ 2</p>
            </div>
            <form class="addLayout01Form" action="/adminIndex/makeEdit2" method="post" enctype="multipart/form-data">
              <input class="d-none" type="text" name="_id" value="<%= lesson._id %>">
              <input class="d-none" type="text" name="layoutId" value="<%= Layout._id %>">

              <div class="row px-4 py-1">
                <div class="underForm-1 col-12">
                  <div class="my-1">
                    <label for="Topic" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 1 >> </span>หัวข้อ: </label>
                    <input type="text" class="form-control p-3 w-75" id="topicInput7" name="Topic" value="<%=Layout.Topic%>" placeholder="ส่วนประกอบฟั..." required>

                  </div>
                  <div class="form my-1 mb-3">
                    <label for="TextArea1" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 2 >> </span>คำอธิบายหรือบรรยาย: </label>
                    <textarea class="form-control w-75 p-3" id="topicInput8" name="TextArea1" style="height: 100px;"><%=Layout.TextArea1%></textarea>

                  </div>
                  <div class="form my-1 mb-3">
                    <label for="TextArea2" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 3 >> </span>คำอธิบายหรือบรรยาย: </label>
                    <textarea class="form-control w-75 p-3" name="TextArea2" id="topicInput9" style="height: 100px;" placeholder=""><%=Layout.TextArea2%></textarea>

                  </div>
                  <div class="form my-1 mb-3">
                    <label for="TextArea3" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 4 >> </span>คำอธิบายหรือบรรยาย: </label>
                    <textarea class="form-control w-75 p-3" name="TextArea3" id="topicInput10" style="height: 100px;" placeholder=""><%=Layout.TextArea3%></textarea>
                  </div>
                </div>
                <div class="d-flex col-12">
                  <button type="submit" class="setRadius submitBtn btn btn-success my-3 p-2 shadow-sm w-25">บันทึก
                    <i class="bi bi-save-fill mx-2"></i>
                  </button>
                  <a href="/adminIndex/deleteLayout?layoutId=<%=Layout._id%>&whatLayout=2&lessonId=<%=lesson._id%>" type="button" class="cancelBtn1 setRadius submitBtn btn btn-danger my-3 p-2 shadow-sm w-25 mx-3">ลบ
                    <!-- <i class="bi bi-save-fill mx-2"></i> -->
                    <i class="bi bi-eraser-fill mx-2"></i>
                  </a>
                </div>
              </div>
              <!-- <div class="IandMain d-grid">
              <input class="input-mainDes form-control mx-4 p-3 h-auto" name="Topic" placeholder="กรอกข้อความหรือคำอธิบาย..." required>
              <div class="d-flex justify-content-end">
                <button type="button" class="cancelIcon2 layout-1-a mx-4">
                  <i class="bi bi-x-lg"></i>
                </button>
              </div>
            </div>
            <div class="setMargin py-4 px-4 bg-white w-100">
              <div class="Layout2Contents w-100">
                <div class="changeLayout02">
                  <div class="Layout2ContentsDiv p-1">
                    <div class="subLayout2Contents bg-white">
                      <textarea name="TextArea1" class="textAreaLayout2 w-100 h-100" placeholder="กรอกข้อความหรือคำอธิบาย..."></textarea>
                    </div>
                    <div class="subLayout2Contents bg-white">
                      <textarea name="TextArea2" class="textAreaLayout2 w-100 h-100" placeholder="กรอกข้อความหรือคำอธิบาย..."></textarea>
                    </div>
                  </div>
                  <div class="subLayout2Contents2 bg-white">
                    <textarea name="TextArea3" class="textAreaLayout2 w-100 h-100" placeholder="กรอกข้อความหรือคำอธิบาย..."></textarea>
                  </div>
                </div>
              </div>
              <div class="add-button-1 w-50 d-flex justify-content-end">

              </div>
              <div class="add-button-2 w-50 d-flex justify-content-end">
                <button type="button" class="setRadius cancelbtnLayout02 btn btn-danger my-3 p-2 shadow-sm w-25 mx-2">ยกเลิก
                  <i class="bi bi-x-lg mx-2"></i>
                </button>
                <button type="submit" class="setRadius submitBtn btn btn-success my-3 p-2 shadow-sm w-25 mx-3">บันทึก
                  <i class="bi bi-save-fill mx-2"></i>
                </button>
              </div>
            </div> -->
            </form>

            <!--  ส่วนที่ลบไป -->
          </div>
          <% } else if (Layout.name == "Layout03") {%>
          <div class="lesson-content py-2 bg-white my-4">
            <div class="d-flex mx-4">
              <p class="fw-bold fs-4 my-3 setpBorder">แก้ไขเนื้อหา รูปแบบที่ 3</p>
            </div>
            <form class="addLayout01Form" action="/adminIndex/makeEdit3" method="post" enctype="multipart/form-data">
              <input class="d-none" type="text" name="_id" value="<%= lesson._id %>">
              <input class="d-none" type="text" name="layoutId" value="<%= Layout._id %>">
              <div class="row px-4 py-1">
                <div class="underForm-1 col-6">
                  <div class="my-1 mb-3">
                    <label for="Description" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 1 >> </span>คำอธิบาย: </label>
                    <input type="text" class="form-control p-3 w-75" id="topicInput11" name="Description" value="<%=Layout.Description%>" required>

                  </div>
                  <div class="my-1 mb-3">
                    <label for="FileForm" class="form-label fs-bold"><span class="fw-bold text-primary">ส่วนที่ 2 >> </span>รูปภาพ: </label><br>
                    <input type="file" class="w-75 img-input" id="topicInput12" style="background-color: white !important;" name="FileForm" accept="image/*,video/*,application/pdf">
                    <p class="fw-bold fs-6" style="margin-top: 1em !important;">รูปภาพหรือวิดีโอเดิมที่ใช้: </p>
                    <div class="w-75">
                      <% if (Layout.contentType.startsWith("image/")) { %>
                        <img class="ImageFile h-75 w-100 mx-auto my-2" src="<%=Layout.file%>" alt="รูปภาพประกอบการเรียน">
                        <%} else if (Layout.contentType.startsWith("video/")) {%>
                        <video class="w-75 h-75 my-4" controls autoplay>
                          <source src="<%=Layout.file%>" type="<%=Layout.contenType%>">
                          Your browser does not support the video tag.
                        </video>
                        <% } %>
                    </div>

                    <!-- <div id="emailHelp" class="form-text my-1">*ไม่ต้องทำการอัปโหลดรูปภาพ หากไม่มีรูปภาพที่ต้องการใช้</div> -->
                  </div>
                  <div class="d-flex my-1">
                    <button type="submit" class="setRadius submitBtn btn btn-success my-3 p-2 shadow-sm w-25">บันทึก
                      <i class="bi bi-save-fill mx-2"></i>
                    </button>
                    <a href="/adminIndex/deleteLayout?layoutId=<%=Layout._id%>&whatLayout=3&lessonId=<%=lesson._id%>" type="button" class="cancelBtn1 setRadius submitBtn btn btn-danger my-3 p-2 shadow-sm w-25 mx-3">ลบ
                      <!-- <i class="bi bi-save-fill mx-2"></i> -->
                      <i class="bi bi-eraser-fill mx-2"></i>
                    </a>
                  </div>
                </div>
                
              </div>
            </form>

          </div>
          <% } else if (Layout.name == "Layout04") {%>
          <div class="lesson-content bg-white my-4">
            <form action="/adminIndex/makeEdit4" method="post" enctype="multipart/form-data">
              <input class="d-none" type="text" name="_id" value="<%= lesson._id %>">
              <div class="IandMain d-grid">
                <input class="input-mainDes form-control mx-4 px-3 mt-4 h-auto" name="Topic" value="<%= Layout.Topic%>" required>
                <div class="d-none">
                  <button type="button" class="cancelIcon4 layout-1-a mx-4">
                    <i class="bi bi-x-lg"></i>
                  </button>
                </div>
              </div>
              <div class="setMargin py-2 px-4 bg-white w-100">
                <div class="Layout2Contents w-100 p-3">
                  <textarea class="teaxtAreaLayout4_1" name="Description" class="w-100 h-25"><%= Layout.Description%></textarea>
                  <div class="columnGrid">
                    <div class="listContents my-2 w-100">
                      <% const List = Layout.Lists %>
                      <% let finalCountImg; %>
                      <% List.forEach((list, index) => { %>
                      <% let countImg = index +1 %>
                      <input type="text" name="list<%=countImg%>" class="form-control w-75 p-1 mb-2" value="<%= list.list %>">
                      <% finalCountImg = countImg; %>
                      <input type="text" class="d-none" name="finalCountImg" value="<%=finalCountImg%>">
                      <% }); %>
                    </div>
                  </div>
                </div>
                <div class="d-flex justify-content-start w-50 mt-2">
                  <button type="submit" class="setRadius submitBtn btn btn-success my-3 p-2 shadow-sm w-25">บันทึก
                    <i class="bi bi-save-fill mx-2"></i>
                  </button>
                  <a href="/adminIndex/deleteLayout?layoutId=<%=Layout._id%>&whatLayout=4&lessonId=<%=lesson._id%>" type="button" class="cancelBtn1 setRadius submitBtn btn btn-danger my-3 p-2 shadow-sm w-25 mx-3">ลบ
                    <!-- <i class="bi bi-save-fill mx-2"></i> -->
                    <i class="bi bi-eraser-fill mx-2"></i>
                  </a>
                </div>
              </div>
            </form>
          </div>
          <% } else if (Layout.name == "pdfFiles") { %>
          <div class="lesson-content py-2 bg-white my-4">
            <div class="d-flex mx-4">
              <p class="fw-bold fs-4 my-3 setpBorder">แก้ไขไฟล์ PDF</p>

            </div>
            <div class="mx-4">
              <form action="/adminIndex/makeEditPdfiles" method="post" enctype="multipart/form-data">
                <input class="d-none" type="text" name="_id" value="<%= lesson._id %>">
                <input class="d-none" type="text" name="layoutId" value="<%= Layout._id %>">                
                <p class="my-1"><span class="text-primary">ไฟล์เดิม:</span> <%=Layout.file.slice(53)%></p>
                <iframe class="pdf-iframe" src="<%=Layout.file%>" frameborder="0"></iframe>
                  <div class="my-2 me-3">
                    <input type="file" name="pdf-file" id="pdf-file" accept="application/pdf" multiple>
                    <button class="btn btn-primary p-1" type="submit">อัปโหลดไฟล์เพื่อแก้ไข</button>
                  </div>
                 <div class="w-50">
                  <a href="/adminIndex/deleteLayout?layoutId=<%=Layout._id%>&whatLayout=5&lessonId=<%=lesson._id%>" type="button" class="cancelBtn1 setRadius submitBtn btn btn-danger mb-2 p-2 shadow-sm w-25">ลบ
                    <!-- <i class="bi bi-save-fill mx-2"></i> -->
                    <i class="bi bi-eraser-fill mx-2"></i>
                  </a>
                 </div>
              </form>
            </div>

          </div>
          <% } else if (Layout.name == "TextEditor"){ %>
            <div class="lesson-content p-4 my-4 bg-white w-100 h-auto">
              <!-- <div class="add-content-header">
                <p class="fw-bold fs-4 my-2 mx-2">เพิ่มเนื้อหา: <span class="text-primary">ปรับแต่งข้อความ</span> </p>
              </div>
              <p class="discription-layout-1 mx-2 my-2">
                <span class="fw-bold text-dark">คำอธิบาย: </span>
                กรอกข้อความและทำการเลือกเครื่องมือเพื่อปรับแต่งหรือออกแบบข้อความได้ตามความต้องการ
              </p> -->
              <div class="toolbar p-2 rounded">
                <div class="head mb-2">
                  <input class="p-1 w-auto" type="text" placeholder="Filename" value="ไม่มีหัวข้อ" id="filename">
                  <input type="hidden" value="<%=lesson._id%>" id="_id">
                  <input type="hidden" value="<%=Layout._id%>" id="layoutId">

                  <select class="p-1" onchange="fileHandle(this.value); this.selectedIndex=0">
                    <option value="" selected="" hidden="" disabled="">ไฟล์</option>
                    <option value="new">ไฟล์ใหม่</option>
                    <option value="txt">บันทึกเป็น .txt</option>
                    <option value="pdf">บันทึกเป็น .pdf</option>
                  </select>
                  <select class="p-1" onchange="formatDoc('formatBlock', this.value); this.selectedIndex=0;">
                    <option value="" selected="" hidden="" disabled="">Format</option>
                    <option value="h1">Heading 1</option>
                    <option value="h2">Heading 2</option>
                    <option value="h3">Heading 3</option>
                    <option value="h4">Heading 4</option>
                    <option value="h5">Heading 5</option>
                    <option value="h6">Heading 6</option>
                    <option value="p">Paragraph</option>
                  </select>
                  <select class="p-1" onchange="formatDoc('fontSize', this.value); this.selectedIndex=0;">
                    <option value="" selected="" hidden="" disabled="">Font size</option>
                    <option value="1">Extra small</option>
                    <option value="2">Small</option>
                    <option value="3">Regular</option>
                    <option value="4">Medium</option>
                    <option value="5">Large</option>
                    <option value="6">Extra Large</option>
                    <option value="7">Big</option>
                  </select>
                  <div class="color">
                    <span>Color</span>
                    <input type="color" oninput="formatDoc('foreColor', this.value); this.value='#000000';">
                  </div>
                  <div class="color">
                    <span>Background</span>
                    <input type="color" oninput="formatDoc('hiliteColor', this.value); this.value='#000000';">
                  </div>

                </div>
                <div class="btn-toolbar">
                  <button onclick="formatDoc('undo')"><i class='bx bx-undo'></i></button>
                  <button onclick="formatDoc('redo')"><i class='bx bx-redo'></i></button>
                  <button onclick="formatDoc('bold')"><i class='bx bx-bold'></i></button>
                  <button onclick="formatDoc('underline')"><i class='bx bx-underline'></i></button>
                  <button onclick="formatDoc('italic')"><i class='bx bx-italic'></i></button>
                  <button onclick="formatDoc('strikeThrough')"><i class='bx bx-strikethrough'></i></button>
                  <button onclick="formatDoc('justifyLeft')"><i class='bx bx-align-left'></i></button>
                  <button onclick="formatDoc('justifyCenter')"><i class='bx bx-align-middle'></i></button>
                  <button onclick="formatDoc('justifyRight')"><i class='bx bx-align-right'></i></button>
                  <button onclick="formatDoc('justifyFull')"><i class='bx bx-align-justify'></i></button>
                  <button onclick="formatDoc('insertOrderedList')"><i class='bx bx-list-ol'></i></button>
                  <button onclick="formatDoc('insertUnorderedList')"><i class='bx bx-list-ul'></i></button>
                  <button onclick="addLink()"><i class='bx bx-link'></i></button>
                  <button onclick="formatDoc('unlink')"><i class='bx bx-unlink'></i></button>
                  <button id="show-code" data-active="false">&lt;/&gt;</button>
                  
                </div>
              </div>
              <div class="mt-2" id="content" contenteditable="true" spellcheck="false">
              <%-Layout.body%>
              </div>
              <div class="d-flex justify-content-end border-top mt-2 pt-3">
                <button  class="btn btn-success p-2 shadow-sm" onclick="saveContent()">บันทึก<i class="bi bi-save-fill mx-2"></i></button>
              </div>
              <!-- <button type="submit" class="setRadius submitBtn4 btn btn-success my-3 p-2 shadow-sm w-25">บันทึก
                <i class="bi bi-save-fill mx-2"></i>
              </button> -->

            </div>
          <% } %>
          <% }); %>
          <div class="row">
            <div class="col-12 d-flex justify-content-center">
              <nav aria-label="Page navigation example">
                <ul class="pagination">
                  <% if (currentPage > 1) { %>
                  <li class="page-item">
                    <a class="page-link px-2" href="/adminIndex/editLessonContent?lesson=<%= lesson._id %>&page=<%= currentPage - 1 %>">ก่อนหน้า</a>
                  </li>
                  <% } else { %>
                  <li class="page-item disabled">
                    <a class="page-link px-2" href="#">ก่อนหน้า</a>
                  </li>
                  <% } %>
  
                  <% for (let i = 1; i <= totalPages; i++) { %>
                  <% if (i === currentPage) { %>
                  <li class="page-item active">
                    <a class="page-link px-2" href="#"><%= i %></a>
                  </li>
                  <% } else { %>
                  <li class="page-item">
                    <a class="page-link px-2" href="/adminIndex/editLessonContent?lesson=<%= lesson._id %>&page=<%= i %>"><%= i %></a>
                  </li>
                  <% } %>
                  <% } %>
  
                  <% if (currentPage < totalPages) { %>
                  <li class="page-item">
                    <a class="page-link px-2" href="/adminIndex/editLessonContent?lesson=<%= lesson._id %>&page=<%= currentPage + 1 %>">ถัดไป</a>
                  </li>
                  <% } else { %>
                  <li class="page-item disabled">
                    <a class="page-link px-2" href="#">ถัดไป</a>
                  </li>
                  <% } %>
                </ul>
              </nav>
            </div>
          </div>
          <% } %>
        </div>
        
      </div>
    </div>
  </div>
  <%- include("./partials/footer.ejs")%>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
     function formatDoc(command, value = null) {
        document.execCommand(command, false, value);
      }

      async function saveContent() {
        const title = document.getElementById('filename').value;
        const _id = document.getElementById('_id').value;
        const layoutId = document.getElementById('layoutId').value;

        const body = document.getElementById('content').innerHTML;

        const response = await fetch('/adminIndex/makeEdittextEditor', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            title,
            body,
            layoutId,
            _id
          }),
        });

        if (response.ok) {
          // alert('Content saved successfully!');
          window.location.href = `/adminIndex/editLessonContent?lesson=${_id}`;
          // res.redirect(`/adminIndex/getMoreAddContent?lesson=${_id}`);
        } else {
          console.log(response);
          alert('Error saving content.');
        }
      }

      function formatDoc(cmd, value = null) {
        if (value) {
          document.execCommand(cmd, false, value);
        } else {
          document.execCommand(cmd);
        }
      }

      function addLink() {
        const url = prompt('Insert url');
        formatDoc('createLink', url);
      }




      const content = document.getElementById('content');

      content.addEventListener('mouseenter', function() {
        const a = content.querySelectorAll('a');
        a.forEach(item => {
          item.addEventListener('mouseenter', function() {
            content.setAttribute('contenteditable', false);
            item.target = '_blank';
          })
          item.addEventListener('mouseleave', function() {
            content.setAttribute('contenteditable', true);
          })
        })
      })


      const showCode = document.getElementById('show-code');
      let active = false;

      showCode.addEventListener('click', function() {
        showCode.dataset.active = !active;
        active = !active
        if (active) {
          content.textContent = content.innerHTML;
          content.setAttribute('contenteditable', false);
        } else {
          content.innerHTML = content.textContent;
          content.setAttribute('contenteditable', true);
        }
      })



      const filename = document.getElementById('filename');

      function fileHandle(value) {
        if (value === 'new') {
          content.innerHTML = '';
          filename.value = 'ไม่มีหัวข้อ';
        } else if (value === 'txt') {
          const blob = new Blob([content.innerText])
          const url = URL.createObjectURL(blob)
          const link = document.createElement('a');
          link.href = url;
          link.download = `${filename.value}.txt`;
          link.click();
        } else if (value === 'pdf') {
          html2pdf(content).save(filename.value);
        }
      }

    // document.getElementById("topicInput5").addEventListener("change", function(event) {
    //   if (event.target.files.length > 0) {
    //     var file = event.target.files[0];
    //     var imageUrl = URL.createObjectURL(file);
    //     // console.log(imageUrl);
    //     document.getElementById("imagePlaceholder").innerHTML = `
    //       <div class="w-auto d-flex justify-content-center">
    //       <img src="${imageUrl}" alt="รูปภาพ" class="img-fluid img222">
    //       </div>`;
    //   }
    // });

    document.getElementById("topicInput12").addEventListener("change", function(event) {
      if (event.target.files.length > 0) {
        var file = event.target.files[0];
        var imageUrl = URL.createObjectURL(file);
        // console.log(imageUrl);
        document.getElementById("imagePlaceholder2").innerHTML = `
          <div class="w-auto d-flex justify-content-center">
          <img src="${imageUrl}" alt="รูปภาพ" class="img-fluid img223">
          </div>`;
      }
    });

    document.querySelectorAll('.aboutImgMain').forEach(element => {
      const countImg = element.getAttribute('data-finalcount');

      for (let i = 1; i <= countImg; i++) {
        $(document).on('change', `.file${i}`, function() {
          // let countFiles = 1;
          var fileName = this.files[0].name;

          if (fileName.includes('.')) {
            var fileParts = fileName.split('.');
            var fileExtension = fileParts.pop();
            var fileNameWithoutExtension = fileParts.join('.');
            var maxLength = 10;

            if (fileNameWithoutExtension.length > maxLength) {
              fileNameWithoutExtension = fileNameWithoutExtension.substring(0, maxLength) + '...';
            }

            var newFileName = fileNameWithoutExtension + '.' + fileExtension;
            document.querySelector(`.new-text${i}`).innerText = newFileName;
            // countFiles++;
          } else {
            document.querySelector(`.new-text${i}`).innerText = fileName;
            // countFiles++;
          }
        })
      }
    });
  </script>

</body>

</html>