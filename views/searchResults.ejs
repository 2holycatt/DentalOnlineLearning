<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search</title>
    <!-- <link rel="stylesheet" href="/css/event.css"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <%- include("./partials/header.ejs")%>
        <style>
            * {
                box-sizing: border-box !important;
            }

            .card-1,
            .card-body-1 {
                border: none !important;
            }

            .descp {
                text-indent: 2em;
                margin: 0 2em;
            }

            .rectangle-141 {
                background-color: white;
                border-radius: 0.75em;
                box-shadow: 0em 0.75em 1.5em -0.25em #919eab1f, 0em 0em 0.125em #919eab33;
                height: 14.6875em;
                width: 75%;
                margin: 2em 2em;
            }

            .home-div,
            .a-home {
                color: #999999 !important;
            }

            .above-nav {
                background-color: white !important;
                border-bottom: 1px solid #999999;
            }

            .dark .above-nav-status {
                background-color: var(--secondary-color) !important;
                border-right: 1px solid #494949;
            }

            .status-a {
                color: #404258 !important;
            }

            .list-lesson-p {
                color: #8A2BE2;
            }

            .list-lesson-p-span {
                color: #4B0082;
            }

            .each-lesson {
                border-top: 0.1em solid #8A2BE2;
            }

            .aside-right {
                background-color: var(--bg-color) !important;
                height: 100%;
            }

            .manange-bar {
                border-radius: 0.5em;
                justify-content: space-between !important;

            }

            .add-button {
                border-radius: 0.5em !important;
                width: 20% !important;
                height: auto !important;
            }

            .lesson-content {
                height: fit-content !important;
                border-radius: 1em !important;
                justify-content: center !important;
            }

            .dark .manange-bar,
            .dark .lesson-content {
                background-color: var(--secondary-color) !important;
            }

            .lesson-nothing {
                margin: 25% 0 !important;
                padding: 0 !important;
            }

            .each-lesson-a {
                text-decoration: none !important;
            }

            .each-lesson-a:hover .each-lesson {
                border-left: 0.2em solid #8A2BE2 !important;
            }

            .card-img-top {
                box-shadow: rgba(0, 0, 0, 0.15) 1.95px 1.95px 2.6px !important;
            }

            .setColumn {
                display: grid !important;
                grid-template-columns: 1fr 1fr 1fr !important;
            }

            .card-a {
                text-decoration: none !important;
            }

            .card-a:hover,
            .card-a:hover .p-lesson-name {
                color: #007bff !important;
                transition: 0.5s;
            }

            .card-a:hover .bi-book {
                color: #007bff !important;
                transition: color 0.5s;
            }

            .bi-book-fill {
                display: none;
            }

            .card-a:hover .bi-book-fill {
                display: inline-block !important;
                transition: 0.5s;
            }

            .card-a:hover .bi-book {
                display: none;
                transition: 0.5s;
            }

            .manange-bar,
            .lesson-content {
                box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px !important;
                border-radius: 0.5em;
            }

            .card-1 {
                width: 90% !important;
                height: fit-content !important;
                transition: all 0.8s cubic-bezier(0.15, 0.83, 0.66, 1);
                cursor: pointer;
                border-radius: 0.5em;
                box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px !important;
            }

            .dark .card-1 {
                box-shadow: lightgray 0px 2px 5px -1px !important;
            }

            .card-1:hover {
                transform: scale(1.05);
            }

            .card-header {
                border-right: 1px solid #EAEFF4;
                border-bottom: 1px solid #EAEFF4;
            }


            #yearSelector {
                border-color: #EAEFF4;
                border-radius: 0.5em;
                background-color: white !important;
                font-size: smaller;
                padding: 0.5em !important;
            }

            #yearSelector option {
                color: #404258;
                background-color: white !important;

            }

            /* .set-border {
      border-bottom: 1px solid #EAEFF4;
      padding-bottom: 1em !important;

    } */

            .set-border-bottom {
                border-bottom: 1px solid #EAEFF4;
                margin-bottom: 1em !important;

            }

            .lesson-bar {
                border-left: 0.25em solid #007bff !important;
                padding-left: 0.5em !important;
                margin-right: 0.5em !important;

            }

            .a-add {
                color: #007bff !important;
            }

            .a-add:hover {
                color: #0053ac !important;
            }

            @media screen and (max-width: 768px) {
                .above-nav-status {
                    display: none;
                }
            }
        </style>

        </style>
</head>


<body>
    <% if (userData.role==='teacher' ) { %>
        <%- include("./partials/nav2.ejs", { theme: theme, isSidebarOpen: isSidebarOpen }) %>
            <% } else { %>
                <%- include("./partials/studentNav.ejs", { theme: theme, isSidebarOpen: isSidebarOpen }) %>
                    <% } %>


                        <div class="main-content d-flex">
                            <% if (userData.role==='teacher' ) { %>
                                <%- include("./partials/lessonsList.ejs")%>
                                    <% } else { %>
                                        <%- include("./partials/studentAside.ejs") %>
                                            <% } %>
                                                <div class="aside-right bg-white h-auto p-4" style="width: 80%;">
                                                    <div class="manange-bar px-4 py-3 bg-white d-flex w-100">
                                                        <p class="fw-bold fs-3 lesson-bar">ผลการค้นหาสำหรับ: <%=
                                                                searchQuery %>
                                                        </p>
                                                    </div>


                                                    <!-- Section for Lessons -->
                                                    <div class="lesson-content p-4 bg-white w-100 my-4">
                                                        <% if (lessons.length==0) { %>
                                                            <div class="d-flex">
                                                                <div class="set-border">
                                                                    <p class="fw-bold fs-5 my-1 mx-2">ไม่พบบทเรียน</p>
                                                                </div>
                                                            </div>
                                                            <% } else { %>
                                                                <div class="set-border d-flex">
                                                                    <p class="fw-bold fs-5 my-1 mx-2"
                                                                        style="border-left: 0.25em solid #387bef; padding-left: 0.75em !important;">
                                                                        บทเรียน</p>
                                                                    <% lessons.forEach(lesson=> { %>
                                                                        <a
                                                                            href="<%= userData.role === 'teacher' ? '/adminIndex/eachLessons?lessonId=' + lesson._id : '/studentIndex/eachLessons?lessonId=' + lesson._id %>">
                                                                            <div class="card-1 text-bg-white mb-3">
                                                                                <p class="text-break">
                                                                                    <%= lesson.LessonName %>
                                                                                </p>
                                                                            </div>
                                                                        </a>
                                                                        <% }) %>
                                                                </div>
                                                                <% } %>
                                                    </div>

                                                    <!-- Section for Quizzes -->
                                                    <div class="lesson-content p-4 bg-white w-100 my-4">
                                                        <% if (quiz.length == 0) { %>
                                                            <div class="d-flex">
                                                                <div class="set-border">
                                                                    <p class="fw-bold fs-5 my-1 mx-2">ไม่พบแบบทดสอบ</p>
                                                                </div>
                                                            </div>
                                                        <% } else { %>

                                                                <% let foundReleasedQuiz = false; %> <!-- ตัวแปรสำหรับเช็คว่าพบแบบทดสอบหรือไม่ -->
                                                    
                                                                <% quiz.forEach(quiz => { %>
                                                                    <% if (userData.role === 'teacher' || (userData.role === 'student' && quiz.isReleased)) { %>
                                                                        <% foundReleasedQuiz = true; %> <!-- ตั้งค่าเป็น true ถ้าพบแบบทดสอบ -->

                                                            <div class="set-border d-flex">
                                                                <p class="fw-bold fs-5 my-1 mx-2"
                                                                    style="border-left: 0.25em solid #387bef; padding-left: 0.75em !important;">
                                                                    แบบทดสอบ
                                                                </p>
                                                    
                                                                        <a href="<%= userData.role === 'teacher' ? '/adminIndex/eachQuiz?quizId=' + quiz._id : '/studentIndex/eachQuiz?quizId=' + quiz._id %>">
                                                                            <div class="card-1 text-bg-white mb-3">
                                                                                <p class="text-break">
                                                                                    <%= quiz.quizname %>
                                                                                </p>
                                                                            </div>
                                                                        </a>
                                                                    <% } %>
                                                                <% }) %>
                                                    
                                                                <% if (!foundReleasedQuiz && userData.role === 'student') { %>
                                                                    <p class="fw-bold fs-5 my-1 mx-2">ไม่พบแบบทดสอบ</p>
                                                                <% } %>
                                                            </div>
                                                        <% } %>
                                                    </div>
                                                    
                                                    
                                                </div>
                        </div>
                        <%- include("./partials/footer.ejs")%>
                            <script>
                                AOS.init();
                            </script>
                            <script>
                                document.getElementById('yearSelector').addEventListener('change', function () {
                                    const selectedYear = this.value;
                                    const showYearAll = document.querySelectorAll(`.showYear`);

                                    showYearAll.forEach(element => {
                                        const classList = element.classList;
                                        for (i = 1; i < 2; i++) {
                                            const getDiv = document.querySelector(`.${classList[i]}`);

                                            const showYearAll2 = document.querySelector(`.show${selectedYear}`);
                                            if (getDiv != showYearAll2) {
                                                getDiv.style.display = "none";
                                            } else if (getDiv === showYearAll2) {
                                                showYearAll2.style.display = "block";
                                            }

                                            if (selectedYear === "all") {
                                                showYearAll.forEach(element => {
                                                    const classList = element.classList;
                                                    for (i = 1; i < 2; i++) {
                                                        const getDiv = document.querySelector(`.${classList[i]}`);
                                                        getDiv.style.display = "block";

                                                    }
                                                });
                                            }
                                        }
                                    });


                                });
                            </script>


</body>


</html>