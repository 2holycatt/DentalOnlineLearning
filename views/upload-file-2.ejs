<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>อัปเดตรายชื่อ</title>
  <%- include("./partials/header.ejs")%>
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"> -->
  <style>
    .add-button {
      width: fit-content !important;
    }

    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap");
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap');

    .setWidth85 {
      width: 85% !important;
    }

    .setWidth70 {
      width: 70% !important;
    }

    /* * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    } */

    .container2 {
      align-items: center;
      display: grid;
      grid-template-columns: 0.5fr 1.5fr;
    }

    .container3 {
      display: grid;
      grid-template-columns: 0.5fr 1.5fr;
    }



    .card {
      border-radius: 0.5em;
      /* box-shadow: 0 5px 10px 0 rgba(0, 0, 0, 0.3); */
      background-color: #ffffff;
      padding: 1em !important;
    }

    .card h3 {
      font-size: x-large;
      font-weight: 600;
      margin-bottom: 0.5em !important;

    }

    .drop_box {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      border: 3px dotted #a3a3a3;
      border-radius: 5px;
      padding: 1.5em 1em !important;
    }

    .drop_box h4 {
      font-size: 16px;
      font-weight: 400;
      color: #2e2e2e;
    }

    .drop_box p {
      font-size: 12px;
      color: #a3a3a3;
    }

    .btn-focus {
      text-decoration: none !important;
      background-color: #005af0 !important;
      color: #ffffff !important;
      padding: 10px 20px !important;
      border: none !important;
      outline: none !important;
      transition: 0.3s !important;
    }

    .btn-focus:hover {
      text-decoration: none !important;
      background-color: #ffffff !important;
      color: #005af0 !important;
      padding: 10px 20px !important;
      border: none !important;
      outline: 1px solid #010101 !important;
    }

    .form input {
      margin: 10px 0;
      width: 100%;
      background-color: #e2e2e2;
      border: none;
      outline: none;
      padding: 12px 20px;
      border-radius: 4px;
    }

    .form-select:focus {
      /* border-color: #000; */
      box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
    }

    .form-select:focus-visible option:checked {
      background-color: #0d6efd;
      color: white;
    }

    .set-border-header {
      border-left: 0.25em solid #387bef;
      padding-left: 0.50em !important;
    }

    .list-div {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
      padding-top: 0.5em;
      border-bottom: 1px solid #EAEFF4;
    }

    .list-div-data {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
      padding-top: 1em;
      border-bottom: 1px solid #EAEFF4;
      text-align: start;

    }

    .setGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    .file-description {
      align-items: normal !important;
    }

    #noteInput {
      display: none;
    }

    .custom-popup {
      padding: 1em 0 !important;
    }

    .custom-icon {
      margin: 2em auto !important;
    }

    .custom-button {
      /* กำหนดลักษณะของ button */
      padding: 0.5em 1em !important;
      margin-top: 1em !important;
    }
  </style>
</head>

<body>
  <div id="blur-container2">
    <%- include("./partials/nav.ejs")%>
    <div class="main-content d-flex w-100 h-auto">
      <%- include("./partials/lessonsList.ejs")%>
      <div class="aside-right w-75 h-auto p-4">
        <div class="manange-bar p-3 bg-white d-flex w-100">
          <p class="fw-bold fs-3">รายชื่อนักศึกษา</p>
          <a href="/adminIndex/uploadStudent" class="add-button btn btn-primary m-0 p-2">
            ย้อนกลับ <i class="bi bi-x-circle-fill mx-2"></i>
          </a>
        </div>
        <!-- <div>
          <form action="/upload" method="post" enctype="multipart/form-data">
            <input type="file" name="excelFile" class="input-file" hidden accept=".xlsx, .xls, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" id="fileID" style="display:none;">
            <button type="submit"></button>
          </form>
        </div> -->
        <div class="lesson-content p-4 bg-white w-100 my-2" style="height: fit-content !important;">
          <div class="pb-3" style="border-bottom: 1px solid #EAEFF4;">
            <p class="fw-bold fs-3 set-border-header">อัปโหลดไฟล์</p>
            <form action="/upload" method="post" enctype="multipart/form-data">
              <div class="container3 my-3" >
                <div class="card shadow-sm" style="height: fit-content !important;">
                  <!-- <h3>Upload Files</h3> -->
                  <div class="drop_box">
                    <header>
                      <h4 class="my-1">เลือกไฟล์ที่จะอัปโหลดที่นี่</h4>
                    </header>
                    <p class="my-1 desText">ไฟล์ที่สามารถอัปโหลดได้: .xls</p>
                    <input type="file" name="excelFile" class="input-file" hidden accept=".xlsx, .xls, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" id="fileID" style="display:none;">
                    <button class="choose-btn btn-focus my-1" type="button">เลือกไฟล์</button>
                  </div>
                </div>
                <div class="file-description w-100">
                  <p class="fw-bold mx-4" style="color: #5A6A85;">คำอธิบายเกี่ยวกับการอัปโหลดไฟล์:
                    <br>
                    <span class="fw-light">
                      1. ข้อมูลที่ได้จากการอัปโหลไฟล์ จะได้แก่ ข้อมูลรายวิชาและข้อมูลนักศึกษา <br>
                      2. ระบบจะบันทึกข้อมูลและรายชื่อการลงทะเบียนเรียนของนักศึกษาและรายวิชาในไฟล์ที่แนบให้อัติโนมัติ <br>
                      3. เมื่อมีอัปโหลดข้อมูลรายวิชาและรายชื่อนักศึกษาที่ซ้ำ ระบบจะไม่ทำการบันทึกการอัปโหลด
                    </span>
                  </p>
                  
                  <p class="fw-bold mx-4 text-success mt-2">ไฟล์ที่รองรับ:
                    <span class="fw-light" style="color: #5A6A85;">ไฟล์ Excel (.xls) ที่ได้จากเว็บไซต์สำนักบริหารและพัฒนาวิชาการ (reg.kku.ac.th)</span>
                  </p>

                  <!-- <p class="fw-bold mx-4 text-success">จำนวนคอลัมน์:
                    <span class="fw-light" style="color: #5A6A85;"> 8 คอลัมน์ หากไฟล์ที่คุณอัปโหลดมีจำนวนคอลัมน์มากกว่าและน้อยกว่า 8 คอลัมน์ <br>
                      จะไม่สามารถอัปโหลดไฟล์ได้
                    </span>
                  </p>
                  <p class="fw-bold mx-4 text-success">ความถูกต้องของข้อมูล:
                    <span class="fw-light" style="color: #5A6A85;"> ควรกรอกข้อมูลให้เหมาะสมกับคอลัมน์ เช่น <span class="text-primary">School_Year</span> ควรกรอกเป็นตัวเลข<br>
                      จำนวน 4 หลัก, <span class="text-primary">Year_Level</span> 1 หลัก และ <span class="text-primary">email</span> ควรมี @
                    </span>
                  </p> -->
                  <p class="fw-bold mx-4 text-danger mt-2">ข้อควรระวัง:
                    <span class="fw-light" style="color: #5A6A85;">
                      <!-- <span class="text-primary">School_Year, Year_Level</span>  -->
                      หลีกเลี่ยงการแก้ไขไฟล์เพิ่มเติมหลังที่จากดาวน์โหลดจากสำนักบริหารและพัฒนาวิชาการ
                    </span>
                  </p>

                  

                </div>
                <div class="mt-3">
                  <p class="fw-bold text-primary text-center">ตัวอย่างไฟล์:</p>
                  <div class="d-flex justify-content-center">
                    <a href="/adminIndex/downloadFile" class="btn btn-outline-primary p-1">
                      <small>Teach_stdlistExcel.xls
                        <i class="bi bi-download ms-1"></i>
                      </small>
                    </a>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <!-- <div class="file-example w-100 mx-3" style="margin-top: 2em !important;">
            <p class="fs-5 fw-bold text-success">
              Example Spreadsheets <i class="bi bi-filetype-xls text-success"></i>
              <span class="fs-6 fw-light mx-2" style="color: #5A6A85;">(3 x 8) แถว/คอลัมน์ แรก</span>
            </p>
            <div class="list-div text-primary" style="font-size: small !important;">
              <p class="fw-normal my-3">
                Student_ID
              </p>
              <p class="fw-normal my-3">
                Prefix
              </p>
              <p class="fw-normal my-3">
                Name
              </p>
              <p class="fw-normal my-3">
                Faculty
              </p>
              <p class="fw-normal my-3">
                Branch
              </p>
              <p class="fw-normal my-3">
                Email
              </p>
              <p class="fw-normal my-3">
                School_Year
              </p>
              <p class="fw-normal my-3">
                Year_Level
              </p>
            </div>
            <div class="list-div-data text-success" style="font-size: small !important;">
              <p class="fw-normal my-3">
                643020388-6
              </p>
              <p class="fw-normal my-3">
                นาย
              </p>
              <p class="fw-normal my-3">
                ปภินวิทย์ สิมาวัน
              </p>
              <p class="fw-normal my-3">
                CP
              </p>
              <p class="fw-normal my-3">
                CS
              </p>
              <p class="fw-normal my-3">
                papinwit.s@k..
              </p>
              <p class="fw-normal my-3">
                2564
              </p>
              <p class="fw-normal my-3">
                3
              </p>
            </div>
            <div class="list-div-data text-success" style="font-size: small !important;">
              <p class="fw-normal my-3">
                643020399-1
              </p>
              <p class="fw-normal my-3">
                นางสาว
              </p>
              <p class="fw-normal my-3">
                ธิดารัตน์ วงศ์วรัญญู
              </p>
              <p class="fw-normal my-3">
                DENT
              </p>
              <p class="fw-normal my-3">
                DE
              </p>
              <p class="fw-normal my-3">
                thaidarat.ws@k..
              </p>
              <p class="fw-normal my-3">
                2561
              </p>
              <p class="fw-normal my-3">
                4
              </p>
            </div>
            <div class="list-div-data text-success" style="font-size: small !important;">
              <p class="fw-normal my-3">
                643020423-0
              </p>
              <p class="fw-normal my-3">
                นาย
              </p>
              <p class="fw-normal my-3">
                อริญชวุธ กัลยานาม
              </p>
              <p class="fw-normal my-3">
                CP
              </p>
              <p class="fw-normal my-3">
                IT
              </p>
              <p class="fw-normal my-3">
                arinchawut.k@..
              </p>
              <p class="fw-normal my-3">
                2564
              </p>
              <p class="fw-normal my-3">
                3
              </p>
            </div>
          </div> -->
          <!-- <hr class="bg-black" style="margin: 2em 0 !important;width:100%; height:0.125em;text-align:left;"> -->
          <p class="fw-bold fs-3 my-4 set-border-header">อัปโหลดแบบฟอร์ม</p>
          <form action="/adminIndex/upload-form" method="post">
            <div class="row">
              <div class="col-12 row my-1 mb-3">
                <div class="col">
                  <label for="studentId" class="form-label fs-bold">รหัสนักศึกษา:</label>
                  <input type="text" class="form-control p-3 w-75" value="<%=formData.studentId%>" name="studentId">
                </div>
                <div class="col">
                  <label for="email" class="form-label fs-bold">Email:</label>
                  <input type="email" class="form-control p-3 w-75" value="<%=formData.email%>" name="email" required>
                </div>
              </div>
              <div class="row col-12">
                <div class="col-6">
                  <div class="row">
                    <div class="col-12 d-flex align-items-center mb-3">
                      <label for="form-check" class="form-label fs-bold me-2">คำนำหน้า:</label>
                      <div class="form-check form-check-inline">
                        <div class="d-flex align-items-center">
                          <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="นาย" required>
                          <label class="form-check-label mx-2" for="inlineRadio1">นาย</label>
                        </div>
                      </div>
                      <div class="form-check form-check-inline">
                        <div class="d-flex align-items-center">
                          <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="นางสาว" required>
                          <label class="form-check-label mx-2" for="inlineRadio2">นางสาว</label>
                        </div>
                      </div>
                      <div class="form-check form-check-inline">
                        <div class="d-flex align-items-center">
                          <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio3" value="นาง" required>
                          <label class="form-check-label mx-2" for="inlineRadio3">นาง</label>
                        </div>
                      </div>
                    </div>
                    <div class="col-12 mb-3">
                      <label for="fname" class="form-label fs-bold">ชื่อ:</label>
                      <input type="text" class="form-control p-3 w-75" value="<%=formData.fname%>" name="fname" required>
                    </div>
                    <div class="col-12 mb-3">
                      <label for="lname" class="form-label fs-bold">นามสกุล:</label>
                      <input type="text" class="form-control p-3 w-75" value="<%=formData.lname%>" name="lname" required>
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="row">
                    <div class="col-12 mb-3">
                      <label for="nickname" class="form-label fs-bold">ชื่อเล่น:</label>
                      <input type="text" class="form-control p-3 w-50" value="<%=formData.nickname%>" name="nickname">
                    </div>
                    <div class="col-12 mb-3">
                      <div class="form-check form-switch">
                        <div class="d-flex align-items-center">
                          <input class="form-check-input" name="externalStudent" type="checkbox" role="switch" id="flexSwitchCheckChecked">
                          <label class="form-check-label mx-2" for="flexSwitchCheckChecked">เป็นนักศึกษาจากภายนอก</label>
                        </div>
                        <small><span class="text-danger">* </span>ในกรณีที่ไม่ใช่นักศึกษาภายในมหาวิทยาลัยขอนแก่น</small>
                      </div>
                    </div>
                    <div class="col-12" id="majorInput">
                      <label for="major" class="form-label fs-bold">คณะ:</label>
                      <input type="text" class="form-control p-3 w-50" value="<%=formData.major%>" name="major">
                    </div>
                    <div class="col-12" id="noteInput">
                      <label for="major" class="form-label fs-bold">หมายเหตุ:</label>
                      <input type="text" class="form-control p-3 w-75" value="<%=formData.note%>" name="note">
                    </div>

                  </div>
                </div>
              </div>
            </div>
            <div class="mt-4">
              <button type="submit" class="btn btn-success py-2 px-3 shadow">
                <span>บันทึก</span><i class="bi bi-save-fill mx-2"></i>
              </button>
            </div>
            <!-- <div class="h-auto">
              <div class="setGrid">
                <div class="w-100">
                  <div class="d-flex justify-content-between">
                    <div class="mb-3">
                      <label for="prefix" class="form-label fs-bold">คำนำหน้า:</label>
                      <input type="text" class="form-control p-3 setWidth70" name="prefix" placeholder="นาง/นาง/นางสาว">
                    </div>
                    <div>
                      <label for="fname" class="form-label fs-bold">ชื่อ:</label>
                      <input type="text" class="form-control p-3 setWidth70" name="fname" placeholder="ชื่อ..." required>
                    </div>
                  </div>
                  <div class="my-1 mb-3">
                    <label for="studentId" class="form-label fs-bold">รหัสนักศึกษา:</label>
                    <input type="text" class="form-control p-3 setWidth85" name="studentId" placeholder="6430xxxxx-x" required>
                   
                  </div>
                  <div class="my-1 mb-3">
                    <label for="schoolYears" class="form-label fs-bold">ชั้นปี:</label>
                    <input type="text" class="form-control p-3 setWidth85" name="schoolYears" placeholder="1, 2, 3 ..." required>
                   
                  </div>
                  <div class="my-1 mb-3">
                    <label for="email" class="form-label fs-bold">Email:</label>
                    <input type="text" class="form-control p-3 setWidth85" name="email" placeholder="papxxx.x@kkumail.com" required>
                   
                  </div>
                  <div class="my-1 mb-3">
                    <label for="schoolYears" class="form-label fs-bold">ปีการศึกษา:</label>
                    <select class="form-select form-select-nm w-50 p-3" name="schoolYears" aria-label="Small select example">
                      <option selected style="color: #dee2e6 !important;" hidden>เลือกปีการศึกษา</option>
                      <% for (let i = 2560; i < 2580 + 1; i++) { %>
                      <option value="<%= i %>"><%= i %></option>
                      <% } %>
                    </select>
                   
                  </div>
                </div>
                //// 
                <div class="w-100">
                  <div class="my-1 mb-3">
                    <label for="lname" class="form-label fs-bold">นามสกุล:</label>
                    <input type="text" class="form-control p-3 w-50" name="lname" placeholder="นามสกุล..." required>
                  </div>
                  <div class="my-1 mb-3">
                    <label for="faculty" class="form-label fs-bold">คณะ:</label>
                    <input type="text" class="form-control p-3 setWidth85" name="faculty" placeholder="คณะ...">
                  </div>
                  <div class="my-1 mb-3">
                    <label for="branch" class="form-label fs-bold">สาขาวิชา:</label>
                    <input type="text" class="form-control p-3 setWidth85" name="branch" placeholder="สาขาวิชา...">
                  </div>
                  <div class="my-1">
                    <label for="section" class="form-label fs-bold">กลุ่มเรียน:</label>
                    <input type="number" class="form-control p-3 w-25" name="section" placeholder="1, 2 หรือ 3 เป็นต้น" required>
                  </div>
                </div>
                <div>
                  <button type="submit" class="btn btn-success py-2 px-3 shadow">
                    <span>บันทึก</span><i class="bi bi-save-fill mx-2"></i>
                  </button>
                </div>
              </div>
            </div> -->
          </form>
        </div>

        <% if (error != null) { %>
        <div id="error-message" style="display: none;"><%=error%></div>
        <% } %>
      </div>
    </div>
    <%- include("./partials/footer.ejs")%>
  </div>

  <script>
    const errorMessage = document.getElementById('error-message');
    const checkbox = document.getElementById('flexSwitchCheckChecked');
    const inputField = document.querySelector('input[name="major"]');
    const noteInput = document.getElementById('noteInput');
    const majorInput = document.getElementById('majorInput');

    checkbox.addEventListener('change', function() {
      if (this.checked) {
        inputField.disabled = true;
        inputField.value = "";
        noteInput.style.display = 'block';
        majorInput.style.display = 'none';
      } else {
        inputField.disabled = false;
        noteInput.style.display = 'none';
        majorInput.style.display = 'block';
      }
    });

    const dropArea = document.querySelector(".drop_box"),
      button = dropArea.querySelector(".choose-btn"),
      dragText = dropArea.querySelector("header"),
      input = dropArea.querySelector(".input-file");
    let file;
    var filename;

    button.onclick = () => {
      input.click();
    };

    input.addEventListener("change", function(e) {
      var fileName = e.target.files[0].name;
      var headerText = document.querySelector('.drop_box header h4');
      var descText = document.querySelector('.desText');

      // เปลี่ยนข้อความใน element เป็นชื่อไฟล์ที่ถูกเลือก
      headerText.textContent = fileName;
      descText.textContent = 'ไฟล์ถูกอัปโหลดแล้ว';
      // let filedata = `
      // <h4 class="my-2">${fileName}</h4>
      //;
      // dropArea.innerHTML = filedata;
      var uploadButton = document.createElement('div');
      uploadButton.classList.add('d-flex', 'justify-content-center', 'my-1');
      uploadButton.innerHTML = `
        <button class="btn-focus">อัปโหลด</button>
        `;
      dropArea.appendChild(uploadButton);

      // ซ่อนปุ่ม "เลือกไฟล์"
      var chooseButton = document.querySelector('.choose-btn');
      chooseButton.style.display = 'none';
    });
    if (errorMessage) {
      let getText = errorMessage.textContent;
      Swal.fire({
        icon: 'warning',
        title: 'ไม่สามารถเพิ่มนักศึกษาได้',
        text: getText,
        customClass: {
          container: 'custom-container',
          popup: 'custom-popup',
          title: 'custom-title',
          icon: 'custom-icon',
          content: 'custom-content',
          confirmButton: 'custom-button'
        },
        timer: 3000
      });

    }
  </script>
</body>

</html>